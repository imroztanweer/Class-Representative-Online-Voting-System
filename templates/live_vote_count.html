{% extends "student_base.html" %}

{% block student_content %}
<h2>Live Vote Count</h2>

{% if results %}
  <style>
    .charts-wrapper {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      gap: 2rem;
    }
    .chart-container {
      flex: 1 1 45%;
      max-width: 45%;
      min-width: 300px;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      backdrop-filter: blur(8px);
    }
    .chart-title {
      text-align: center;
      margin-bottom: 1rem;
    }
    canvas {
      width: 100% !important;
      height: auto !important;
      max-height: 300px;
    }
    @media (max-width: 768px) {
      .chart-container {
        flex: 1 1 100%;
        max-width: 100%;
      }
      canvas {
        max-height: 250px;
      }
    }
  </style>

  <div class="charts-wrapper">
    {% for position, candidates in results.items() %}
      <section class="chart-container">
        <h3 class="chart-title">{{ position }}</h3>
        <canvas id="chart-{{ loop.index }}"></canvas>
      </section>
    {% endfor %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    {% for position, candidates in results.items() %}
      const ctx{{ loop.index }} = document.getElementById('chart-{{ loop.index }}').getContext('2d');
      const data{{ loop.index }} = {
        labels: [{% for c in candidates %}"{{ c.candidate or 'N/A' }}",{% endfor %}],
        datasets: [{
          label: 'Votes',
          data: [{% for c in candidates %}{{ c.votes }},{% endfor %}],
          backgroundColor: [
            'rgba(255, 99, 132, 0.5)',
            'rgba(54, 162, 235, 0.5)',
            'rgba(255, 206, 86, 0.5)',
            'rgba(75, 192, 192, 0.5)',
            'rgba(153, 102, 255, 0.5)',
            'rgba(255, 159, 64, 0.5)'
          ],
          borderColor: [
            'rgba(255, 99, 132, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)'
          ],
          borderWidth: 1,
          borderRadius: 6,
        }]
      };
      const config{{ loop.index }} = {
        type: 'bar',
        data: data{{ loop.index }},
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                precision: 0
              }
            }
          },
          plugins: {
            legend: { display: false }
          }
        }
      };
      new Chart(ctx{{ loop.index }}, config{{ loop.index }});
    {% endfor %}
  </script>
{% else %}
  <p>No vote data available yet.</p>
{% endif %}
{% endblock %}
