{% extends "student_base.html" %}

{% block student_content %}

<header style="background:#b3d4fc; padding:1rem; border-radius:8px; display:flex; justify-content:flex-start; color:#003366; font-weight:600; margin-bottom:1rem;">
  <div>
    <p style="margin:0;">Welcome, {{ session.name }}</p>
    <p style="margin:0; font-size:0.9rem;">
      Reg No: {{ session.user }} | {{ session.course }} - Batch {{ session.batch }}
    </p>
    <p style="margin:0; font-size:0.9rem;">
      Voting Status:
      {% if session.voted %}
        <span style="color:green;">Voted</span>
      {% else %}
        <span style="color:red;">Not Voted</span>
      {% endif %}
    </p>
  </div>
</header>

<section style="background:#f5faff; padding:1rem; border-radius:8px; color:#003366; margin-bottom:1rem;">
  <h3 style="margin-top:0;">{{ election.title }}</h3>
  <p><strong>Start:</strong> {{ election.start_date }}</p>
  <p><strong>Deadline:</strong> {{ election.deadline }}</p>
  <div id="countdown" style="font-weight: bold; margin-top: 0.5rem;"></div>
</section>

<div style="margin-bottom:1rem;">
  {% if not session.voted and started %}
    <a href="{{ url_for('vote') }}"><button>Cast Your Vote</button></a>
  {% elif not started %}
    <p style="color: gray;">Voting has not started yet.</p>
  {% endif %}
</div>

<script>
  const deadline = new Date("{{ election.deadline }}").getTime();

  function updateCountdown() {
    const now = new Date().getTime();
    const distance = deadline - now;

    if (distance < 0) {
      document.getElementById("countdown").innerHTML = "Voting has ended.";
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hrs = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const mins = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const secs = Math.floor((distance % (1000 * 60)) / 1000);

    document.getElementById("countdown").innerHTML =
      `Time Remaining: ${days}d ${hrs}h ${mins}m ${secs}s`;
  }

  updateCountdown();
  setInterval(updateCountdown, 1000);
</script>

{% endblock %}
