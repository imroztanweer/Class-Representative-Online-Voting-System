{% extends "base.html" %}
{% block content %}

<h2 class="page-heading">ğŸ¯ Modify Candidates</h2>

<!-- Add Candidate Form -->
<div class="glass-box">
  <form method="POST" action="{{ url_for('manage_candidates') }}" class="flex-form">
    <input type="hidden" name="action" value="add">
    <input type="text" name="name" placeholder="Candidate Name" required>
    <select name="position_id" required>
      <option value="" disabled selected>Select Position</option>
      {% for pos in positions %}
        <option value="{{ pos.id }}">{{ pos.name }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="btn-add">â• Add Candidate</button>
  </form>
</div>

<hr>

<!-- Existing Candidates -->
<h3 class="section-heading">ğŸ“‹ Existing Candidates</h3>
<div class="glass-box scroll-table">
  <table class="glass-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Position</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for c in candidates %}
      <tr>
        <td>{{ c.name }}</td>
        <td>
          {% set icon = {
            'President': 'ğŸ“',
            'Secretary': 'ğŸ—’ï¸',
            'Treasurer': 'ğŸ’°',
            'Cultural Head': 'ğŸ­',
            'Sports Captain': 'ğŸ…',
            'Vice President': 'ğŸ§‘â€ğŸ’¼',
            'Tech Lead': 'ğŸ’»'
          }[c.position] %}
          {{ icon }} {{ c.position }}
        </td>
        <td>
          <button class="btn-update" onclick="openEditModal('{{ c.id }}', '{{ c.name }}', '{{ c.position }}')">âœï¸ Edit</button>
          <form method="POST" action="{{ url_for('manage_candidates') }}" onsubmit="return confirm('Delete this candidate?')" style="display:inline-block;">
            <input type="hidden" name="action" value="delete">
            <input type="hidden" name="id" value="{{ c.id }}">
            <button type="submit" class="btn-danger">ğŸ—‘ï¸ Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Modal for Editing -->
<div id="edit-modal" class="modal">
  <div class="modal-content glass-box">
    <span class="modal-close" onclick="closeEditModal()">&times;</span>
    <h3>Edit Candidate</h3>
    <form method="POST" action="{{ url_for('manage_candidates') }}" id="edit-form">
      <input type="hidden" name="action" value="edit">
      <input type="hidden" name="id" id="edit-id">
      <label>Name</label>
      <input type="text" name="name" id="edit-name" required>
      <label>Position</label>
      <select name="position_id" id="edit-position" required>
        {% for pos in positions %}
          <option value="{{ pos.id }}">{{ pos.name }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="btn-update">âœ… Save Changes</button>
    </form>
  </div>
</div>

<a href="{{ url_for('admin_dashboard') }}" class="votex-login-btn" style="margin-top: 2rem; display: inline-block;">â† Back to Dashboard</a>

<style>
.flex-form {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: center;
}
.flex-form input,
.flex-form select,
.flex-form button {
  min-width: 180px;
  flex: 1;
}

.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.4);
  backdrop-filter: blur(6px);
  padding-top: 60px;
}

.modal-content {
  background: rgba(255,255,255,0.12);
  margin: auto;
  padding: 2rem;
  border: 1px solid #ccc;
  width: 90%;
  max-width: 500px;
  border-radius: 16px;
  color: var(--text);
}

.modal-close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}
.modal-close:hover {
  color: #000;
}
.modal input,
.modal select {
  width: 100%;
  padding: 0.6rem;
  margin: 0.5rem 0 1rem;
  border-radius: 10px;
  border: 1px solid #ccc;
  background: rgba(255,255,255,0.1);
  color: var(--text);
}
</style>

<script>
function openEditModal(id, name, position) {
  document.getElementById('edit-id').value = id;
  document.getElementById('edit-name').value = name;

  const select = document.getElementById('edit-position');
  for (let option of select.options) {
    if (option.textContent === position) {
      option.selected = true;
      break;
    }
  }

  document.getElementById('edit-modal').style.display = 'block';
}

function closeEditModal() {
  document.getElementById('edit-modal').style.display = 'none';
}
window.onclick = function(event) {
  const modal = document.getElementById('edit-modal');
  if (event.target === modal) {
    closeEditModal();
  }
}
</script>

{% endblock %}
